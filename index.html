<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>MV STUDIO PRO - LIVE HUB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root { --main: #ffaa00; }
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; background: #000; overflow: hidden; color: white; font-family: sans-serif; }
        #viewport { position: relative; width: 100%; height: calc(100% - 140px); background: #111; }
        #cam-box { position: absolute; z-index: 10; top: 20px; right: 20px; }
        #ai-canvas { width: 350px; border: 1px solid var(--main); }
        #controls { position: absolute; bottom: 0; width: 100%; height: 140px; background: #080808; display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; padding: 5px; border-top: 1px solid #222; }
        .panel { background: #111; border: 1px solid #222; padding: 5px; display: flex; flex-direction: column; gap: 4px; }
        .panel h3 { font-size: 8px; color: var(--main); text-align: center; text-transform: uppercase; margin-bottom: 2px; }
        .btn { width: 100%; padding: 5px; font-weight: bold; border-radius: 4px; font-size: 8px; cursor: pointer; border: none; text-transform: uppercase; }
        .btn-blue { background: #1e3a8a; color: white; }
        .btn-orange { background: var(--main); color: black; }
        .st-off { background: #220a0a; color: #cc4444; }
        .st-on { background: #0a220a; color: #44cc44; }
    </style>
</head>
<body>

<div id="viewport">
    <div id="cam-box"><canvas id="ai-canvas"></canvas></div>
    <video id="v-remote" autoplay playsinline style="display:none"></video>
    <div style="position:absolute; bottom:20px; left:20px; font-size:30px; font-weight:900;">STUDIO MV LINK</div>
</div>

<div id="controls">
    <div class="panel"><h3>1. VIDEO</h3><button class="btn btn-blue">UPLOAD VIDEO</button></div>
    <div class="panel"><h3>2. FOTO</h3><button class="btn btn-blue">UPLOAD FOTO</button></div>
    <div class="panel"><h3>3. SLIDE</h3><button class="btn btn-blue">FOLDER SLIDE</button></div>
    
    <div class="panel">
        <h3>4. REMOTE CAMERA</h3>
        <button id="btn-listen" class="btn btn-orange" onclick="startReceiver()">ACTIVATE RECEIVER</button>
        <button id="btn-view" class="btn st-off">VIEW: OFF</button>
    </div>
    
    <div class="panel"><h3>5. VUMETRU</h3><button class="btn btn-blue">UPLOAD PNG</button></div>
    <div class="panel"><h3>6. SISTEM</h3><button class="btn btn-blue" onclick="document.documentElement.requestFullscreen()">FULL SCREEN</button></div>
</div>

<script>
    // ID FIX PENTRU RECEPTOR
    const peer = new Peer('LAPTOP-MV-STUDIO'); 

    function startReceiver() {
        alert("RECEPTOR ACTIVAT! AÈ™tept semnalul de la telefon...");
        document.getElementById('btn-listen').innerText = "LISTENING...";
        document.getElementById('btn-listen').className = "btn st-on";
        
        peer.on('call', call => {
            call.answer();
            call.on('stream', remoteStream => {
                const v = document.getElementById('v-remote');
                v.srcObject = remoteStream;
                v.play();
                document.getElementById('btn-view').className = "btn st-on";
                document.getElementById('btn-view').innerText = "VIEW: ON";
                // Pornim AI-ul pe imaginea primita
                const pred = async () => { await selfie.send({image: v}); requestAnimationFrame(pred); }; 
                pred();
            });
        });
    }

    const selfie = new SelfieSegmentation({locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${f}`});
    selfie.setOptions({modelSelection: 1});
    selfie.onResults(r => {
        const can = document.getElementById('ai-canvas'), ctx = can.getContext('2d');
        can.width = r.image.width; can.height = r.image.height;
        ctx.save(); ctx.clearRect(0,0,can.width,can.height);
        ctx.drawImage(r.segmentationMask, 0,0,can.width,can.height);
        ctx.globalCompositeOperation = 'source-in';
        ctx.drawImage(r.image, 0,0,can.width,can.height); ctx.restore();
    });
</script>
</body>
</html>
